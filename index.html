<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Instrument Control Lib: Instrument Control Lib</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Instrument Control Lib
   </div>
   <div id="projectbrief">Framework to control Oscilloscopes, SMUs, Function Generators and DC Powersupplies via Ethernet.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Instrument Control Lib </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_instrument_control_lib_instrument_control_lib_README"></a> <img src="docs_and_specs/figures/Logo.svg" alt="" style="pointer-events: none;" class="inline"/></p>
<p>This repository contains the code to configure oscilloscopes, signal generators, DC Power-supplies and other measurement devices. <br  />
<br  />
 It provides following functionality: <br  />
</p>
<ul>
<li>Establishing a network connection and identifying the different types of devices <br  />
</li>
<li>Execution of VISA commands on the devices. E.g. setting the voltage on a DC power-supply, Setting voltage limits on SMUs or to gather the current data of an oscilloscope <br  />
</li>
<li>CSV export function to directly store the output of measure devices in an *.csv file. <br  />
</li>
<li>Environment to set up test cases, configured by an XML file. <br  />
</li>
<li>Platform independent implementation (tested on Windows, MAC OS and Ubuntu)</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Supported Devices</h1>
<h3><a class="anchor" id="autotoc_md2"></a>
   - SPD1305X DC Power Supply</h3>
<h3><a class="anchor" id="autotoc_md3"></a>
   - Keysight 33500B Waveform Generator</h3>
<h3><a class="anchor" id="autotoc_md4"></a>
   - Keysight InfiniiVision 3000A X-Series Oscilloscopes</h3>
<h3><a class="anchor" id="autotoc_md5"></a>
   - Tektronix 2600B Series SMU</h3>
<h1><a class="anchor" id="autotoc_md6"></a>
Continuous integration</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">OS   </th><th class="markdownTableHeadCenter">Status    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Windows Latest   </td><td class="markdownTableBodyCenter"><img src="https://github.com/FlorianFrank/instrument_control_lib/actions/workflows/windows_latest.yml/badge.svg" alt="Windows latest" style="pointer-events: none;" class="inline"/>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Mac OS Latest   </td><td class="markdownTableBodyCenter"><img src="https://github.com/FlorianFrank/instrument_control_lib/actions/workflows/mac_os_latest.yml/badge.svg" alt="MAC OS latest" style="pointer-events: none;" class="inline"/>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">Ubuntu Latest   </td><td class="markdownTableBodyCenter"><img src="https://github.com/FlorianFrank/instrument_control_lib/actions/workflows/ubuntu_latest.yml/badge.svg" alt="Ubuntu Latest" style="pointer-events: none;" class="inline"/>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md7"></a>
Documentation</h1>
<p>See <a href="https://florianfrank.github.io/instrument_control_lib/">https://florianfrank.github.io/instrument_control_lib/index.html</a> for an overview of all available operations and further documentation. This documentation is built automatically, so it is always up to date.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Build</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
1. Build from master branch</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
1.1 Checkout repository</h3>
<div class="fragment"><div class="line">git clone git@github.com:FlorianFrank/instrument_control_lib.git</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
1.2 Configure build</h3>
<p>Adjust the configuration files according to your needs.</p>
<div class="fragment"><div class="line">option(INSTRUMENT_LIB_BUILD_STATIC &quot;Build instrument lib as static library&quot;     ON)</div>
<div class="line"> </div>
<div class="line"># Definitions for the platform independent abstraction layer.</div>
<div class="line">option(PIL_COMMUNICATION    &quot;Enable PIL Sockets&quot;          ON)</div>
<div class="line">option(PIL_THREADING        &quot;Enable PIL Threads&quot;          ON)</div>
<div class="line">option(PIL_LOGGING          &quot;Enable Logging support&quot;      ON)</div>
<div class="line">option(PIL_SHARED           &quot;BUILD PIL as shared library&quot; OFF)</div>
<div class="line">option(PIL_STATIC           &quot;BUILD PIL as static library&quot; ON)</div>
<div class="line">option(PIL_CXX              &quot;Enable PIL C++ support&quot;      ON)</div>
<div class="line"> </div>
<div class="line"># PugiXML options</div>
<div class="line">option(BUILD_SHARED_LIBS    &quot;Build pugiXML as shared lib&quot; OFF)</div>
<div class="line">set(PUGI_XML_VERSION 1.12)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
1.3 Build the library</h3>
<p>On Linux and MAC OS run:</p>
<div class="fragment"><div class="line">./build.sh</div>
</div><!-- fragment --><p>On Windows run:</p>
<div class="fragment"><div class="line">.\build.bat</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md13"></a>
1.4 Exporting the library</h3>
<p>You can find the library in the <b>build</b> folder.</p>
<div class="fragment"><div class="line">out</div>
<div class="line">├── include          Here you can find the device and include fines for the project</div>
<div class="line">├── ĺib              Here you can find the libraries to link to your project.</div>
<div class="line">├── bin              In this folder you can find sample test programs, like a command line interface.</div>
<div class="line">├── doc              This folder contains the doxygen documentation.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
2. Download pre-installed packages</h2>
<h3><a class="anchor" id="autotoc_md15"></a>
2.1 Download a released version from github.</h3>
<p>Go to:<br  />
 <a href="https://github.com/FlorianFrank/instrument_control_lib/tags">Instrument Control Packages</a> and download the preferred version.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
2.2 Install the package</h3>
<h3><a class="anchor" id="autotoc_md17"></a>
2.2.1 On Debian based systems</h3>
<p>Execute:</p>
<div class="fragment"><div class="line">dpkg -i instrument_control_lib.deb</div>
</div><!-- fragment --><p>The files are copied into the **/usr/bin, /usr/lib/,** and **/usr/include** folders and can be linked and included in any program.</p>
<h3><a class="anchor" id="autotoc_md18"></a>
2.2.2 On Windows systems</h3>
<p>Run the graphical installer.</p>
<h3><a class="anchor" id="autotoc_md19"></a>
2.2.3 On MAC OS systems</h3>
<p>Run the graphical installer.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Examples</h1>
<p>See the <a href="./examples">examples</a> directory for samples on how to use this lib with C++ and with Python.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Connect to devices</h2>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">#include &quot;kst33500.h&quot; // include right device header file</div>
<div class="line"> </div>
<div class="line">int main() {</div>
<div class="line">    // provide a IP address, some devices may need an extra port parameter</div>
<div class="line">    KST33500 k(&quot;xx.xx.xx.xx&quot;, &lt;timeout&gt;); </div>
<div class="line">    k.Connect();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md22"></a>
Development</h1>
<p>In this lab, we use sockets to send SCPI commands to devices in order control them remotely. <br  />
 Check the documents in <a href="./docs%20and%20specs">Docs</a> for SCPI commands.</p>
<p>Basically, you can run any commands using Exec commands. For saving time, we wrapped some frequently used commands. But we cannot wrap all the commands.</p>
<p>Here is an instruction for wrapping a command. Let's say you want to wrap a command of Keysight waveform generator:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">FUNCtion &lt;function&gt;</div>
</div><!-- fragment --><p>which sets a &lt;function&gt; waveform. <br  />
 Go to kst33500.h file and add a function signature called "function".</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">int function(string fun);</div>
</div><!-- fragment --><p>Go to kst33500.cpp file and add the implementation of this function. What you need to do is making an SCPI command and invoke the Exec function.</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">int KST33500::function(string fun) {</div>
<div class="line">    string msg = &quot;FUNCtion &quot; + fun;</div>
<div class="line">    Exec(msg);</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>That's it. After that, you can use it like this:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">k.function(&quot;SIN&quot;);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
Tutorial Python interface</h1>
<ol type="1">
<li><p class="startli">Easy installation with pip.</p>
<p class="startli">Execute <code>pip install .</code> in the root directory to install the instrument control lib for the current python installation. You can now just import py_instrument_control_lib and use it just like the C++ lib. With the pip installer the lib now supports autocompletion and type hints.</p>
</li>
<li>Open the python console<ol type="a">
<li>Make sure you installed the lib using pip</li>
<li>Open the library as module</li>
<li>Create a <a class="el" href="classSMU.html" title="Dummy class to allow assignment to SMU class.">SMU</a> object with an IP and an timeout for the socket</li>
<li>Connect to the <a class="el" href="classSMU.html" title="Dummy class to allow assignment to SMU class.">SMU</a></li>
<li>You can check the error code which should be ERROR_CODE.NO_ERROR<ul>
<li>All defined error codes are listed below</li>
</ul>
</li>
</ol>
</li>
</ol>
<div class="fragment"><div class="line">$ python3</div>
<div class="line">&gt;&gt;&gt; from py_instrument_control_lib import *</div>
<div class="line">&gt;&gt;&gt; smu = KEI2600(&quot;192.168.1.10&quot;, 2000, SEND_METHOD.DIRECT_SEND)</div>
<div class="line">&gt;&gt;&gt; error_code = smu.connect()</div>
<div class="line">&gt;&gt;&gt; print(error_code)</div>
<div class="line">ERROR_CODE.NO_ERROR</div>
<div class="line">&gt;&gt;&gt; device_identifier = smu.getDeviceIdentifier()</div>
<div class="line">&gt;&gt;&gt; print(device_identifier)</div>
<div class="line">Keithley Instruments Inc*, Model 2636B, 4031</div>
<div class="line">&gt;&gt;&gt; error_code = smu.setLevel(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, 3.3, False)</div>
<div class="line">&gt;&gt;&gt; if error_code != ERROR_CODE.NO_ERROR: </div>
<div class="line">          pass  # stop execution or do some error handling</div>
<div class="line">&gt;&gt;&gt; error_code = smu.setLimit(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, 5.0, False)</div>
<div class="line">&gt;&gt;&gt; # error handling</div>
<div class="line">&gt;&gt;&gt; error_code = smu.turnOn(SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">&gt;&gt;&gt; # error handling</div>
<div class="line">&gt;&gt;&gt; measure_value = smu.measure(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_B, False)</div>
<div class="line">  &gt;&gt;&gt; print(measure_value)</div>
<div class="line">3.04</div>
<div class="line">  &gt;&gt;&gt; smu.disconnect()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Functions</h2>
<p>This list gives an overview of the smu functions and how to call them.</p>
<div class="fragment"><div class="line"># Establish the connection to the device</div>
<div class="line">error_code = smu.connect()</div>
<div class="line">error_code = smu.disconnect()</div>
<div class="line"> </div>
<div class="line">error_code = smu.turnOn(SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">error_code = smu.turnOff(SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">value = smu.measure(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">value = smu.measure(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">value = smu.measure(SMU_UNIT.RESISTANCE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">value = smu.measure(SMU_UNIT.POWER, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.setLevel(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, 3.3, False)</div>
<div class="line">error_code = smu.setLevel(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, 0.1, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.setLimit(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, 3.3, False)</div>
<div class="line">error_code = smu.setLimit(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, 0.1, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.enableMeasureAutoRange(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">error_code = smu.enableMeasureAutoRange(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.disableMeasureAutoRange(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">error_code = smu.disableMeasureAutoRange(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.enableSourceAutoRange(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">error_code = smu.enableSourceeAutoRange(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.disableSourceAutoRange(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line">error_code = smu.disableSourceAutoRange(SMU_UNIT.CURRENT, SMU_CHANNEL.CHANNEL_A, False)</div>
<div class="line"> </div>
<div class="line">smu.setSenseMode(SMU_CHANNEL.CHANNEL_A, SMU_SENSE.LOCAL, False)</div>
<div class="line"> </div>
<div class="line">error_code = smu.setSourceRange(SMU_UNIT.VOLTAGE, SMU_CHANNEL.CHANNEL_A, 3.0, False)</div>
<div class="line"> </div>
<div class="line">device_description = smu.getDeviceIdentifier()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Error codes</h2>
<p>There is a function which transforms the error codes into Strings. Some error codes are not used in the library because these are derived from the abstraction library. <b>This function will be implemented in python soon!</b></p>
<div class="fragment"><div class="line"># No error occurred</div>
<div class="line">NO_ERROR</div>
<div class="line"># Invalid arguments passed to a function, e.g. passing a nullptr.</div>
<div class="line">PIL_INVALID_ARGUMENT</div>
<div class="line"># An error occured and an errno error code was set. </div>
<div class="line"># Internal error message can be requested by the error handle</div>
<div class="line">ERRNO</div>
<div class="line"># Error when performing an operation on a closed interface.</div>
<div class="line">INTERFACE_CLOSED</div>
<div class="line"># Error when baudrate cannot be set. E.g. when the approximation function has a higher deviation then 2 %.</div>
<div class="line">INVALID_BAUDRATE</div>
<div class="line"># Error insufficient resources.</div>
<div class="line">INSUFFICIENT_RESOURCES</div>
<div class="line"># Error, insufficient permissions to perform a certain operation.</div>
<div class="line">INSUFFICIENT_PERMISSIONS</div>
<div class="line"># Error, when deadlock is detected in a multithreaded application.</div>
<div class="line">DEADLOCK_DETECTED</div>
<div class="line"># Error while joining a thread.</div>
<div class="line">THREAD_NOT_JOINABLE</div>
<div class="line"># Error performing an operation on on a not initialized thread.</div>
<div class="line">THREAD_NOT_FOUND</div>
<div class="line"># Error entire file could not be written.</div>
<div class="line">ONLY_PARTIALLY_READ_WRITTEN</div>
<div class="line"># Error no such file or directory.</div>
<div class="line">NO_SUCH_FILE</div>
<div class="line"># Invalid error code.</div>
<div class="line">UNKNOWN_ERROR</div>
<div class="line"># Error while parsing an XML file.</div>
<div class="line">XML_PARSING_ERROR</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
